language: cpp

compiler:
- gcc

sudo: required

#rvm:
#- gcc_4.9
#- gcc_5.2
#- python_plot
#- gnuplot

# Setup compiler
before_install:
- echo "Setting up development environment"
- sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
- sudo apt-get update -qq
- sudo apt-get install -qq g++-4.9
- sudo apt-get install -qq build-essential
- export CXX="g++-4.9"
- export CC="gcc-4.9"
- gcc --version
- autoconf --version
- automake --version
- m4 --version

# Install dependencies: (Boost, samtools and dlib)
install:

- mkdir -p exdeps
- cd exdeps

# Python3 and sphinx
- sudo apt-get install python3-dev
- sudo apt-get install python-pip
- sudo pip install --upgrade pip
- sudo pip install sphinx
- sudo pip install --upgrade sphinx
- sudo apt-get install samtools

# Boost installation
- echo "Installing Boost"
- wget -q http://sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.gz/download
- mv download boost.tar.gz
- tar -xf boost.tar.gz
- cd boost_1_59_0
- sudo ./bootstrap.sh --with-libraries=chrono,timer,program_options,filesystem,system
- sudo ./b2 -d0 --toolset=gcc-4.9 install
- cd ..

# Samtools installation (just use an old version for now... ideally use V1.3 to be consistent with internal htslib)
#- echo "Installing Samtools"
#- wget -q https://github.com/samtools/samtools/releases/download/1.3/samtools-1.3.tar.bz2
#- tar -xf samtools-1.3.tar.bz2
#- cd samtools-1.3
#- make
#- sudo make install
#- cd ..

# Get Dlib
- echo "Installing DLIB"
- wget -q http://dlib.net/files/dlib-18.18.tar.bz2
- tar -xf dlib-18.18.tar.bz2
- echo $TRAVIS_BUILD_DIR/exdeps/dlib-18.18
- export CPPFLAGS="$CPPFLAGS -isystem $TRAVIS_BUILD_DIR/exdeps/dlib-18.18"

# Go back
- cd $TRAVIS_BUILD_DIR

# Create portcullis configure script
before_script:
- echo "Setting up portcullis"
- ./autogen.sh

# Build portcullis and run tests
script:
- echo "Configuring portcullis"
- ./configure
- echo "Building portcullis"
- make
- echo "Testing portcullis"
- make check
- echo "Testing portcullis works from a distributable and installs and uninstalls correctly"
- make distcheck

